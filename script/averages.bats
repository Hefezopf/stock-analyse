#!/usr/bin/env bats

# https://github.com/bats-core/bats-core
# load '/d/code/bats-assert/load.bash'

# Import
. ./script/averages.sh

# Constants
OUT_RESULT_FILE="test/_result.html"
DATA_FILE="test/BEI.txt"
TICKER_NAMES_FILE="test/ticker_name_id.txt"
SYMBOL=BEI
SYMBOL_NAME="BEIERSDORF AG"

@test "MACD_12_26" {
  averagePriceList12=", , , , , , , , , , , 233.75, 234.481, 233.869, 234.274, 233.54, 233.38, 232.937, 232.485, 232.18, 232.306, 233.259, 232.988, 232.528, 231.754, 231.715, 232.143, 232.121, 231.795, 232.519, 233.055, 235.354, 237.3, 238.792, 239.593, 241.194, 242.933, 244.789, 246.283, 248.316, 250.498, 252.344, 252.676, 253.957, 255.194, 256.087, 256.766, 257.11, 257.247, 257.594, 259.041, 259.496, 260.343, 260.444, 261.299, 259.407, 258.421, 255.818, 254.461, 254.005, 249.85, 246.565, 243.401, 239.57, 236.559, 233.473, 230.554, 228.546, 227.77, 228.036, 228.646, 229.239, 230.125, 230.26, 228.989, 227.452, 225.921, 224.933, 224.174, 223.224, 222.728, 222.308, 221.876, 221.203, 219.787, 217.974, 217.44, 216.757, 216.256, 215.601, 214.739, 213.779, 209.105, 206.535, 205.222, 202.049, 200.749, 199.465, 196.593, 196.102,"
  averagePriceList26=" , , , , , , , , , , , , , , , , , , , , , , , , , 232.904, 233.022, 232.946, 232.728, 233.007, 233.229, 234.323, 235.336, 236.2, 236.778, 237.757, 238.849, 240.045, 241.116, 242.478, 243.961, 245.334, 246.013, 247.123, 248.225, 249.171, 250.01, 250.676, 251.219, 251.832, 252.956, 253.626, 254.469, 254.953, 255.771, 255.269, 255.101, 254.094, 253.569, 253.416, 251.459, 249.758, 247.998, 245.813, 243.901, 241.871, 239.844, 238.189, 237.101, 236.538, 236.202, 235.928, 235.859, 235.499, 234.499, 233.351, 232.177, 231.238, 230.406, 229.487, 228.784, 228.133, 227.494, 226.754, 225.661, 224.353, 223.623, 222.836, 222.144, 221.393, 220.549, 219.656, 216.97, 215.15, 213.88, 211.711, 210.369, 209.038, 206.946, 205.943,"
  MACD_12_26 "$averagePriceList12" "$averagePriceList26"
 [ "$MACDList" == ' , , , , , , , , , , , , -0.88, -0.88, -0.82, -0.93, -0.49, -0.17, 1.03, 1.96, 2.59, 2.82, 3.44, 4.08, 4.74, 5.17, 5.84, 6.54, 7.01, 6.66, 6.83, 6.97, 6.92, 6.76, 6.43, 6.03, 5.76, 6.09, 5.87, 5.87, 5.49, 5.53, 4.14, 3.32, 1.72, 0.89, 0.59, -1.61, -3.19, -4.60, -6.24, -7.34, -8.40, -9.29, -9.64, -9.33, -8.50, -7.56, -6.69, -5.73, -5.24, -5.51, -5.90, -6.26, -6.30, -6.23, -6.26, -6.06, -5.82, -5.62, -5.55, -5.87, -6.38, -6.18, -6.08, -5.89, -5.79, -5.81, -5.88, -7.86, -8.61, -8.66, -9.66, -9.62, -9.57, -10.35, -9.84,' ]
}

@test "EMAverageOfDays" {
  averagePriceList=""
  EMAverageOfDays 12 test/AHLA.txt
  [ "$averagePriceList" == ' , , , , , , , , , , , 231.167, 233.449, 234.226, 233.653, 234.091, 233.385, 233.249, 232.826, 232.391, 232.1, 232.238, 233.201, 232.939, 232.487, 231.72, 231.686, 232.119, 232.101, 231.778, 232.504, 233.042, 235.343, 237.29, 238.784, 239.586, 241.188, 242.928, 244.785, 246.28, 248.314, 250.496, 252.343, 252.675, 253.956, 255.194, 256.087, 256.766, 257.11, 257.247, 257.594, 259.041, 259.496, 260.343, 260.444, 261.299, 259.407, 258.421, 255.818, 254.461, 254.005, 249.85, 246.565, 243.401, 239.57, 236.559, 233.473, 230.554, 228.546, 227.77, 228.036, 228.646, 229.239, 230.125, 230.26, 228.989, 227.452, 225.921, 224.933, 224.174, 223.224, 222.728, 222.308, 221.876, 221.203, 219.787, 217.974, 217.44, 216.757, 216.256, 215.601, 214.739, 213.779, 209.105, 206.535, 205.222, 202.049, 200.749, 199.465, 196.593,' ]

  averagePriceList=""
  EMAverageOfDays 26 test/AHLA.txt
  [ "$averagePriceList" == ' , , , , , , , , , , , , , , , , , , , , , , , , , 232.269, 232.212, 232.381, 232.353, 232.179, 232.499, 232.758, 233.887, 234.932, 235.826, 236.431, 237.436, 238.552, 239.77, 240.861, 242.242, 243.743, 245.132, 245.826, 246.95, 248.065, 249.023, 249.873, 250.549, 251.101, 251.723, 252.855, 253.532, 254.381, 254.871, 255.695, 255.199, 255.036, 254.033, 253.512, 253.363, 251.41, 249.713, 247.956, 245.774, 243.865, 241.838, 239.813, 238.16, 237.074, 236.513, 236.179, 235.906, 235.839, 235.481, 234.482, 233.335, 232.162, 231.224, 230.393, 229.475, 228.773, 228.123, 227.484, 226.744, 225.652, 224.344, 223.615, 222.829, 222.138, 221.387, 220.544, 219.652, 216.967, 215.147, 213.877, 211.708, 210.367, 209.036, 206.944,' ]
}

@test "AverageOfDays" {
  AverageOfDays 14 "$DATA_FILE"
  [ "$averagePriceList" == ' 97.6086, 97.1421, 96.5629, 96.1479, 95.6471, 95.6329, 95.7471, 95.8257, 95.9357, 95.9543, 96.0971, 96.3714, 96.4757, 96.7186, 96.9129, 97.22, 97.4757, 97.5757, 97.7629, 97.8329, 97.8714, 97.7957, 97.55, 97.3014, 97.0186, 96.5571, 96.2214, 96.0557, 96.0343, 95.8971, 95.8271, 95.7786, 95.6529, 95.6014, 95.4929, 95.5914, 95.9429, 96.2886, 96.5986, 97.1136, 97.5707, 97.9157, 98.1543, 98.4329, 98.5514, 98.6486, 98.8357, 99.0286, 99.2957, 99.0586, 98.5143, 97.87, 97.2543, 96.6207, 96.2679, 95.7929, 95.3114, 95.1357, 95.1686, 95.3279, 95.455, 95.5693, 95.6693, 96.1264, 96.625, 97.1393, 97.6064, 97.8993, 97.8964, 98.005, 98.1036, 97.8507, 97.4421, 96.8786, 96.2486, 95.5143, 94.8271, 94.2029, 93.7757, 93.3686, 92.9429, 92.6486, 92.5486, 92.33, 92.3443, 92.2586, 92.2214,' ]
}

@test "RSIOfDays" {
  RSIOfDays 14 "$DATA_FILE"
  [ "$RSIQuoteList" == ' 34, 29, 21, 31, 27, 49, 58, 55, 57, 51, 60, 70, 56, 64, 61, 65, 62, 55, 60, 53, 52, 46, 39, 38, 36, 30, 33, 43, 49, 43, 46, 47, 44, 47, 45, 54, 68, 68, 67, 80, 75, 71, 66, 68, 56, 55, 60, 60, 65, 40, 30, 27, 28, 27, 38, 32, 32, 44, 51, 54, 53, 53, 53, 68, 70, 71, 70, 62, 49, 54, 53, 36, 28, 19, 16, 12, 16, 17, 24, 24, 24, 29, 42, 30, 50, 44, 47,' ]
}

@test "StochasticOfDays" {
  StochasticOfDays 14 "$DATA_FILE"
  [ "$stochasticQuoteList" == ' 0, 4, 6, 25, 52, 88, 100, 76, 82, 100, 100, 100, 51, 66, 47, 87, 67, 54, 64, 45, 44, 0, 0, 11, 24, 0, 0, 47, 65, 76, 82, 79, 78, 87, 80, 91, 100, 100, 100, 100, 66, 100, 93, 100, 58, 47, 65, 77, 79, 0, 0, 0, 6, 13, 34, 33, 30, 83, 93, 100, 100, 100, 100, 87, 66, 59, 56, 27, 4, 22, 12, 16, 1, 0, 0, 0, 7, 0, 7, 3, 0, 5, 27, 24, 97, 69, 56,' ]
}
